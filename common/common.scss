// Theme's SCSS


/* Hide core filtered notice per component requirements */
div.posts-filtered-notice { display: none; }


/* ===== Group-based access control ===== */

/* Hide theme component features when access is not granted */

/* This is a fallback; shouldRender should prevent rendering entirely */
body:not(.theme-component-access-granted) {
  .owner-toggle-wrapper,
  .owner-toggle-button {
    display: none !important;
  }
}


/* ===== Outlet-based toggle buttons ===== */

/* Desktop: timeline footer controls placement */
.owner-toggle-wrapper--timeline {
  margin-left: 0.5rem;

  .owner-toggle-button {
    // Align with other timeline controls
    padding: 0.5rem 0.75rem;
    font-size: var(--font-down-1);
  }
}

/* Mobile: before topic progress placement */
.owner-toggle-wrapper--mobile {
  display: flex;
  justify-content: center;
  padding-right: var(--space-3);

  .owner-toggle-button {
    // Make it prominent on mobile
    padding: 0.75rem 1.25rem;
    box-shadow: 0 1px 4px rgb(0, 0, 0, 0.1);
    border-radius: 4px;

    // Ensure label is visible on mobile
    .d-button-label {
      display: inline !important;
    }
  }
}

/* Common button styling */
.owner-toggle-button {
  transition: all 0.2s ease;

  &.filtered {
    background: var(--tertiary-low);
    color: var(--tertiary);
    border-color: var(--tertiary);
  }

  &:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgb(0, 0, 0, 0.15);
  }
}


/* ===== Reply Button Icon Color Override ===== */

/* Override the default grey color for reply button icons */
nav.post-controls button.reply .d-icon {
  color: var(--d-button-primary-text-color)!important;
}


/* ===== Post Action Menu — Visual Consistency ===== */

/*
 * Unified styling for Show Replies and Reply buttons in post action menu
 * - Show Replies: consistent appearance in both collapsed/expanded states
 * - Reply: styled as primary action button to stand out
 * - Both buttons have proper hover, active, and focus states for accessibility
 */

/* Desktop — Show Replies Button (collapsed state) */
@media screen and (min-width: 769px) {
  button.post-action-menu__show-replies[aria-expanded="false"] {
    color: var(--primary-900);
    background: var(--primary-100);
    transition: all 0.2s ease;

    .d-icon {
      color: currentColor;
    }

    &:hover {
      color: var(--d-post-control-text-color--hover);
      background: var(--d-post-control-background--hover);
    }

    &:focus-visible {
      outline: 2px solid var(--primary-300);
      outline-offset: 2px;
    }
  }

  /* Expanded state keeps default Discourse styling */
  button.post-action-menu__show-replies[aria-expanded="true"] {
    .d-icon {
      color: currentColor;
    }
  }
}

/* Mobile — Show Replies Button (collapsed state) */
@media screen and (max-width: 768px) {
  button.post-action-menu__show-replies[aria-expanded="false"] {
    color: var(--primary-900);
    background: var(--primary-100);
    transition: all 0.2s ease;

    .d-icon {
      color: currentColor;
    }

    &:hover {
      color: var(--d-post-control-text-color--hover);
      background: var(--d-post-control-background--hover);
    }

    &:focus-visible {
      outline: 2px solid var(--primary-300);
      outline-offset: 2px;
    }
  }

  /* Expanded state keeps default Discourse styling */
  button.post-action-menu__show-replies[aria-expanded="true"] {
    .d-icon {
      color: currentColor;
    }
  }
}

/* Reply Button — Primary Action Styling (Desktop & Mobile) */
button.post-action-menu__reply {
  display: inline-flex !important;
  align-items: center !important;
  justify-content: center !important;
  margin: 0 !important;
  font-weight: normal !important;
  color: var(--d-button-primary-text-color) !important;
  background-color: var(--d-button-primary-bg-color) !important;
  background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0)) !important;
  border-radius: var(--d-button-border-radius) !important;
  transition: var(--d-button-transition) !important;
  cursor: pointer !important;
  font-size: var(--font-0) !important;
  line-height: normal !important;
  box-sizing: border-box !important;
  padding: 0.5em 0.65em !important;
  border: var(--d-button-border) !important;
  opacity: 1 !important;

  .d-icon {
    color: var(--d-button-primary-text-color) !important;
  }

  &:hover {
    background-color: var(--d-button-primary-bg-color--hover) !important;
    color: var(--d-button-primary-text-color--hover) !important;

    .d-icon {
      color: var(--d-button-primary-text-color--hover) !important;
    }
  }

  &:focus-visible {
    outline: 2px solid var(--tertiary-low) !important;
    outline-offset: 2px !important;
  }
}


/* ===== Hide Reply Buttons for Non-Owners ===== */

/*
 * IMPORTANT: These rules target posts classified as non-owner-post
 * The JavaScript in hide-reply-buttons.gjs adds this class to posts based on:
 *   - Setting enabled (hide_reply_buttons_for_non_owners)
 *   - Topic in configured category (owner_comment_categories)
 *   - Post author is NOT the topic owner
 *
 * This applies in both filtered and regular topic views.
 * Does not check Allowed groups setting.
 */

/* Hide post-level reply buttons on posts authored by non-owners */
article.topic-post.non-owner-post {
  nav.post-controls .actions button.create,
  nav.post-controls .actions button.reply,
  nav.post-controls .actions button.reply-to-post,
  .topic-body .actions button.create,
  .topic-body .actions button.reply,
  .topic-body .actions button.reply-to-post {
    display: none !important;
  }
}


/* ===== Embedded Reply Buttons ===== */

/*
 * Styling for section-level reply button in embedded posts
 * This button appears once per section.embedded-posts, positioned next to the collapse button
 */

/* Container for the reply and collapse buttons */
.embedded-posts-controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  margin-top: 1rem;
  padding: 0.5rem;
}

.embedded-reply-button {
  padding: 0.25rem 0.75rem;
  font-size: var(--font-down-1);
  background-color: var(--tertiary);
  color: var(--secondary);
  border: 1px solid var(--tertiary);
  border-radius: 4px;
  cursor: pointer;
  transition: all 0.2s ease;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  white-space: nowrap;

  &:hover {
    background-color: var(--tertiary-hover, var(--tertiary));
    filter: brightness(0.9);
    transform: translateY(-1px);
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  }

  &:active {
    background-color: var(--tertiary-high, var(--tertiary));
    filter: brightness(0.85);
    transform: translateY(0);
  }

  &:focus {
    outline: 2px solid var(--tertiary-low);
    outline-offset: 2px;
  }
}

/* Desktop-specific positioning adjustments */
@media screen and (min-width: 769px) {
  section.embedded-posts > .embedded-posts-controls .embedded-reply-button {
    position: absolute;
    left: 64px;
    bottom: 50%;
  }
}

/* Ensure the section has proper layout */
section.embedded-posts {
  /* Ensure controls container is properly positioned */
  > .embedded-posts-controls {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }

  /* Legacy support for other footer containers */
  > footer,
  > .embedded-posts-footer,
  > .embedded-posts__footer {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
  }
}

/* ===== Load More Button Styling ===== */

/* Desktop view - Load More button */
@media (min-width: 40rem) {
  .embedded-posts .load-more-replies {
    font-size: var(--font-down-1);
    position: absolute;
    left: 50%;
    transform: translate(-50%, -130%);
    padding: 0.35em 0.5em;
  }
}

/* Tablet view - Load More button for bottom embedded posts */
@media (min-width: 40rem) {
  .embedded-posts.bottom .load-more-replies {
    font-size: var(--font-down-1);
    position: absolute;
    left: 55%;
    transform: translate(-50%, -150%);
    padding: var(--space-1) var(--space-2);
  }
}

/* Smartphone view - Load More button */
@media (max-width: 40rem) {
  .embedded-posts .load-more-replies {
    font-size: var(--font-down-1);
    position: absolute;
    left: 50%;
    transform: translate(1%, -230%);
    padding: 0.35em 0.5em;
  }
}


/* ===== Mobile-specific adjustments ===== */
@media screen and (max-width: 768px) {
  /* Ensure controls stay on one line and left-aligned on small screens */
  section.embedded-posts > .embedded-posts-controls {
    display: flex;
    flex-direction: row; /* keep buttons in horizontal layout */
    flex-wrap: nowrap;   /* prevent wrapping to the next line */
    justify-content: flex-start; /* left-align the button group */
    align-items: center; /* vertical centering */
    gap: 0.5rem;         /* consistent spacing between buttons */
    padding: 0.25rem 0.5rem;
    margin-top: 0.5rem;
  }

  /* Make sure both buttons behave as non-wrapping inline items */
  section.embedded-posts > .embedded-posts-controls .embedded-reply-button,
  section.embedded-posts > .embedded-posts-controls .widget-button.collapse-up {
    flex: 0 0 auto;
  }

  /* Ensure correct horizontal order: Collapse (left) then Reply (right) */
  section.embedded-posts > .embedded-posts-controls .widget-button.collapse-up {
    order: 1;
  }
  section.embedded-posts > .embedded-posts-controls .embedded-reply-button {
    order: 2;
    position: relative;
    left: 10%;
    bottom: 9px;
  }

  /* Normalize the collapse button box so it aligns with the Reply button */
  section.embedded-posts > .embedded-posts-controls .widget-button.collapse-up {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    vertical-align: middle;
  }
}


/* ===== Auto-scroll highlight effect ===== */

/*
 * Temporary highlight for newly created embedded posts after auto-scroll
 * Applied for 2 seconds to provide visual feedback
 */

@keyframes highlightFadeIn {
  0% {
    background-color: var(--tertiary-very-low);
    box-shadow: 0 0 0 0 var(--tertiary-low);
  }
  50% {
    background-color: var(--tertiary-low);
    box-shadow: 0 0 0 4px var(--tertiary-very-low);
  }
  100% {
    background-color: var(--tertiary-very-low);
    box-shadow: 0 0 0 0 var(--tertiary-low);
  }
}

.highlighted-reply {
  animation: highlightFadeIn 2s ease-in-out;
  border-left: 3px solid var(--tertiary) !important;
  transition: border-left 0.3s ease;
}

